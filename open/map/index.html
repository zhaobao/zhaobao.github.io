<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Location</title>
    <style type="text/css">
        body, html,#allmap {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin:0;
        }
        label.BMapLabel {
            border-radius: 4px;
            font-size: 12px !important;
        }
    </style>
</head>
<body>
<div id="allmap"></div>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=rA4MsufTmMThGVHbIc9HTeVeCSBBEp27"></script>
<script type="text/javascript">
    (function() {
        var Map = {
            map: null,
            icon: null,
            init: function() {
                // 初始化地图
                Map.map = new BMap.Map("allmap");
                // 初始化中心点和初始缩放级别
                var point = new BMap.Point(116.400244,39.97556);
                Map.map.centerAndZoom(point, 13);
                // 增加左上角控制
                var opts = {type: BMAP_NAVIGATION_CONTROL_SMALL};
                Map.map.addControl(new BMap.NavigationControl(opts));
                Map.icon = new BMap.Icon("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjMzRUY4M0Y5RkFGMzExRTVCNjE3RkM2RkJCMUVBRjI3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjMzRUY4M0ZBRkFGMzExRTVCNjE3RkM2RkJCMUVBRjI3Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MzNFRjgzRjdGQUYzMTFFNUI2MTdGQzZGQkIxRUFGMjciIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MzNFRjgzRjhGQUYzMTFFNUI2MTdGQzZGQkIxRUFGMjciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4iQ8+fAAAAHlBMVEX/BQD1S0j85+f8FA/6IR70lpT/BwL0gH7+Cwf////7B2K1AAAACnRSTlP///////////8AsswszwAAADhJREFUeNpMjUkOACAIxMom8P8Pm6iJ9NTDLLSGmEloo+kF5amEc/BA1tUlGA+bOgKjNsb+xRZgADP+APGiH6iYAAAAAElFTkSuQmCC", new BMap.Size(10, 10));
                Map.ajaxData();
            },
            ajaxData: function() {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "data2.json", true);
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        var json = JSON.parse(xhr.responseText);
                        var fineData = [];
                        var nameArray = [];
                        for (var i = 0, len = json.length; i < len; i++) {
                            var name = json[i].name;
                            var location = json[i].location;
                            if (location.length < 4) continue;
                            if (nameArray.indexOf(name) == -1) {
                                nameArray.push(name);
                            } else {
                                continue;
                            }
                            fineData.push(json[i]);
                        }
                        Map.parseLocation2(fineData);
                    }
                };
                xhr.onerror = function(e) {
                    console.log(e);
                };
                xhr.send();
            },
            parseLocation2: function(data) {
                // 创建地址解析器实例
                for (var i = 0, len = data.length; i < len; i++) {
                    var point = {
                        'lat': data[i]['lat'],
                        'lng': data[i]['lng']
                    };
                    var pp = new BMap.Marker(point, {icon: Map.icon});
                    Map.map.addOverlay(pp);
                }
            },
            parseLocation: function(data) {
                // 创建地址解析器实例
                var count = data.length;
                var myGeo = new BMap.Geocoder();
                for (var i = 0, len = data.length; i < len; i++) {
                    (function(i) {

                        myGeo.getPoint(data[i]['location'], function(point) {
                            try {
                                var pp = new BMap.Marker(point, {icon: Map.icon});
                                Map.map.addOverlay(pp);
                                if (point) {
                                    data[i]['lat'] = point['lat'];
                                    data[i]['lng'] = point['lng'];
                                } else {
                                    data[i]['lat'] = '';
                                    data[i]['lng'] = '';
                                }
                            } catch(e) {

                            }
                            if (i === count - 1) {
                                console.log(JSON.stringify(data));
                            }
                        }, "北京市");
                    })(i);
                }
            }
        };

        Map.init();
    })();
</script>
</body>
</html>